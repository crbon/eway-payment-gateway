// eWAY Payment Gateway
// https://shop.webaware.com.au/downloads/eway-payment-gateway/

!function(e){var a=e(eway_ecrypt_vars.form);function r(r,n){var t=a.find(r);if(t.length){var c=t.val().replace(/[\s-]/g,""),o=c.length;if(o){if(n.is_cardnum&&!function(e){for(var a,r=0,n=1,t=e.length-1;t>=0;t--)a=e.charAt(t)*n,n=1===n?2:1,a>=10&&(r++,a-=10),r+=a;return r%10==0}(c))throw{name:"Credit Card Error",message:eway_ecrypt_msg.card_number_invalid,field:t};var p=eCrypt.encryptValue(c,eway_ecrypt_vars.key);a.find("input[name='"+n.name+"']").remove(),e("<input type='hidden'>").attr("name",n.name).val(p).appendTo(a),t.val("").data("eway-old-placeholder",t.prop("placeholder")).prop("placeholder",function(e,a){for(var r=e,n=a;--n>=1;)r+=e;return r}(eway_ecrypt_msg.ecrypt_mask,o))}}}function n(e){var a=eway_ecrypt_vars.fields;try{for(var n in a)r(n,a[n])}catch(a){return e.preventDefault(),a.field.focus(),window.alert(a.message),!1}return!0}function t(e){return a.get(0).elements[e].value}switch(eway_ecrypt_vars.mode){case"woocommerce":a.on("checkout_place_order_eway_payments",n),e(document.body).on("checkout_error",function(){var e,r=eway_ecrypt_vars.fields;for(var n in r)(e=a.find(n)).length&&e.prop("placeholder",e.data("eway-old-placeholder"))});break;case"wp-e-commerce":a.on("submit",function(e){"wpsc_merchant_eway"===t("custom_gateway")&&n(e)});break;case"events-manager":a.on("submit",function(e){"eway"===t("gateway")&&n(e)});break;case"awpcp":a.on("submit",n)}}(jQuery);