// eWAY Payment Gateway
// https://shop.webaware.com.au/downloads/eway-payment-gateway/

"use strict";!function(i){var r=eway_ecrypt_vars.fields,s=i(eway_ecrypt_vars.form);var u="function"==typeof String.prototype.repeat?function(e,a){return e.repeat(a)}:function(e,a){for(var r=e,t=1;t<a;t++)r+=e;return r};function t(e,a){var r=s.find(e);if(r.length){var t=r.val().replace(/[\s-]/g,""),n=t.length;if(n){if(a.is_cardnum&&!function(e){for(var a=0,r=1,t=e.length-1;0<=t;t--){var n=e.charAt(t)*r,r=1===r?2:1;10<=n&&(a++,n-=10),a+=n}return a%10==0}(t))throw{name:"Credit Card Error",message:eway_ecrypt_msg.card_number_invalid,field:r};var c=eCrypt.encryptValue(t,eway_ecrypt_vars.key),o=function(e,a,r){if(r){var t=u(e,4);return t+" "+t+" "+t+" "+t}return u(e,a)}(eway_ecrypt_msg.ecrypt_mask,n,a.is_cardnum);s.find("input[name='"+a.name+"']").remove(),i("<input type='hidden'>").attr("name",a.name).val(c).appendTo(s),a.false_fill?r.val(o):r.val("").data("eway-old-placeholder",r.prop("placeholder")).prop("placeholder",o)}}}function a(a){try{Object.keys(r).forEach(function(e){t(e,r[e])})}catch(e){return a.preventDefault(),e.field.focus(),window.alert(e.message),!1}return!0}function n(e){var a=!!s.length&&s.get(0).elements[e];return!!a&&a.value}function c(){Object.keys(r).forEach(function(e){var a=s.find(e);a.length&&(r[e].false_fill?a.val(""):a.prop("placeholder",a.data("eway-old-placeholder")))})}function o(e){"eway"===n("gateway")&&a(e)}function e(e,a,r){-1!==r.data.indexOf("em_checkout_page_contents")&&(s=i(eway_ecrypt_vars.form),c(),s.on("submit",o))}function f(){s=i(eway_ecrypt_vars.form),Object.keys(r).forEach(function(e){var a=i(e);if(0<a.length&&a.val().substring(0,1)!==eway_ecrypt_msg.ecrypt_mask)try{t(e,r[e])}catch(e){SPCO.form_is_valid=!1,event.preventDefault(),e.field.focus(),window.alert(e.message)}})}switch(eway_ecrypt_vars.mode){case"woocommerce":s.on("checkout_place_order_eway_payments",a),i(document.body).on("checkout_error",c);break;case"wp-e-commerce":s.on("submit",function(e){"wpsc_merchant_eway"===n("custom_gateway")&&a(e)});break;case"events-manager":s.on("submit",o),i(document).on("em_checkout_page_refresh",function(){i(document).ajaxComplete(e)});break;case"event-espresso":i(document).ready(function(){SPCO.main_container.on("process_next_step_button_click",f)});break;case"awpcp":s.on("submit",a)}}(jQuery);