// Eway Payment Gateway
// https://shop.webaware.com.au/downloads/eway-payment-gateway/

!function(n){var a=eway_ecrypt_vars.fields,c=n(eway_ecrypt_vars.form);var o="function"==typeof String.prototype.repeat?function(e,t){return e.repeat(t)}:function(e,t){for(var a=e,r=1;r<t;r++)a+=e;return a};function r(e,t){var a=c.find(e);if(a.length){var r=a.val().replace(/[\s-]/g,""),e=r.length;if(e){if(t.is_cardnum&&!function(e){for(var t=0,a=1,r=e.length-1;0<=r;r--){var n=e.charAt(r)*a,a=1===a?2:1;10<=n&&(t++,n-=10),t+=n}return t%10==0}(r))throw{name:"Credit Card Error",message:eway_ecrypt_msg.card_number_invalid,field:a};r=eCrypt.encryptValue(r,eway_ecrypt_vars.key),e=function(e,t,a){if(a){a=o(e,4);return a+" "+a+" "+a+" "+a}return o(e,t)}(eway_ecrypt_msg.ecrypt_mask,e,t.is_cardnum);c.find("input[name='"+t.name+"']").remove(),n("<input type='hidden'>").attr("name",t.name).val(r).appendTo(c),t.false_fill?a.val(e):a.val("").data("eway-old-placeholder",a.prop("placeholder")).prop("placeholder",e)}}}function t(t){try{Object.keys(a).forEach(function(e){r(e,a[e])})}catch(e){return t.preventDefault(),e.field.focus(),window.alert(e.message),!1}return!0}function i(e){e=!!c.length&&c.get(0).elements[e];return!!e&&e.value}function s(){Object.keys(a).forEach(function(e){var t=c.find(e);t.length&&(a[e].false_fill?t.val(""):t.prop("placeholder",t.data("eway-old-placeholder")))})}function u(e){"eway"===i("gateway")&&t(e)}function e(e,t,a){-1!==a.data.indexOf("em_checkout_page_contents")&&(c=n(eway_ecrypt_vars.form),s(),c.on("submit",u))}function f(){c=n(eway_ecrypt_vars.form),Object.keys(a).forEach(function(e){var t=n(e);if(0<t.length&&t.val().substring(0,1)!==eway_ecrypt_msg.ecrypt_mask)try{r(e,a[e])}catch(e){SPCO.form_is_valid=!1,window.event.preventDefault(),e.field.focus(),window.alert(e.message)}})}switch(eway_ecrypt_vars.mode){case"woocommerce":c.on("checkout_place_order_eway_payments",t),n(document.body).on("checkout_error",s);break;case"wp-e-commerce":c.on("submit",function(e){"wpsc_merchant_eway"===i("custom_gateway")&&t(e)});break;case"events-manager":c.on("submit",u),n(document).on("em_checkout_page_refresh",function(){n(document).ajaxComplete(e)});break;case"event-espresso":n(document).ready(function(){SPCO.main_container.on("process_next_step_button_click",f)});break;case"awpcp":c.on("submit",t)}}(jQuery);